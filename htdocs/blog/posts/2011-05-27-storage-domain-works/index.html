<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>2011-05-27-storage-domain-works</title>

<link rel="stylesheet" href="../../style.css" type="text/css" />

<link rel="stylesheet" href="../../local.css" type="text/css" />





</head>
<body>

<div class="pageheader">
<div class="header">
<span>
<span class="parentlinks">

<a href="../../">Dave Scott</a>/ 

<a href="../">posts</a>/ 

</span>
<span class="title">
2011-05-27-storage-domain-works

</span>
</span><!--.header-->

</div>


<div class="actions">
<ul>


<li><a href="../../recentchanges/">RecentChanges</a></li>





<li><a href="./#comments">Comments</a><br /></li>

</ul>
</div>




</div> <!-- .pageheader -->



<div id="content">
<h2>My first XCP storage driver domain!</h2>

<p>Last week I said that I need to:</p>

<ol>
<li>remote the storage control plane (VDI.attach et al): <em>DONE</em>
<ul>
<li>VDI.{create,destroy,attach,activate,deactivate,detach}, SR.{attach,detach} all included in the xapi&lt;-&gt;storage interface and now remotable</li>
</ul></li>
<li>configure blkback endpoints in domains other than 0: <em>DONE</em>
<ul>
<li>VDI.attach now returns blkback information, rather than a path in domain 0</li>
<li>places where "0" has been hardcoded have been removed</li>
</ul></li>
<li>make sure that qemu can still read the disks (it currently knows a little too much about the devices being in domain 0): <em>DONE</em>
<ul>
<li>xapi now configures two VBDs per <em>emulated</em> disk: one for the PV drivers and one for the IO emulator i.e. qemu.</li>
<li>unfortunately I had to patch out a </li>
</ul></li>
<li>create an example storage domain to prove it works: <em>DONE</em>
<ul>
<li>I used a CentOS domU with the XCP dom0 kernel plus a hacky python script</li>
</ul></li>
</ol>

<p>Here's my current task list:</p>

<table border="1">
    <th><td>Description</td><td>Depends</td><td>Status</td></th>
    <tr>
        <td>1</td>
        <td>create a method for remoting the SMAPI (storage control plane)</td>
        <td></td>
        <td><a href="https://github.com/xen-org/xen-api/commit/349d28deb93bc4587d896ee236469b5ca46d959a">merged</a></td>
    </tr>
    <tr>
        <td>2</td>
        <td>allow lots of blkfronts in domain 0 (for qemus)</td>
        <td></td>
        <td><a href="https://github.com/xen-org/xen-api/commit/1a8307db366b6c575e333a5c5ff528b9c7e1dbfb">merged</a></td>
    </tr>
    <tr>
        <td>3</td>
        <td>VDI.attach needs to return the info we need for blkback, not a path in dom0</td>
        <td>1</td>
        <td>Not started</td>
    </tr>
    <tr>
        <td>4</td>
        <td>disks which qemu needs require blkfront instances in dom0</td>
        <td>2</td>
        <td>Not started</td>
    </tr>
    <tr>
        <td>5</td>
        <td>remoted SMAPI needs fleshed-out with SR.create, SR.destroy, VDI.create, VDI.destroy etc</td>
        <td>1</td>
        <td>Not started</td>
    </tr>
    <tr>
        <td>6</td>
        <td>add a simple policy associating a driver domain (VM) with an SR or PBD</td>
        <td>1</td>
        <td>Not started</td>
    </tr>
    <tr>
        <td>7</td>
        <td>create an example storage domain with FreeBSD?</td>
        <td>1</td>
        <td>Not started</td>
    </tr>
    <tr>
        <td>8</td>
        <td>create a domain 0 storage control multiplexor capable of (eg) starting storage domains on-demand</td>
        <td>6</td>
        <td>Not started</td>
    </tr>
</table>

<p>So far I've focused on pieces which also coincidentally fix existing bugs in XCP: this is why some changes have already been merged into mainline. The rest of the tasks are clearly only useful for the driver domain case so I'll keep these in a personal branch on github.</p>

</div>


<div id="comments">




<div class="addcomment">Comments on this page are closed.</div>

</div>


<div id="footer" class="pagefooter">
<div id="pageinfo">









<div class="pagedate">
Last edited <span class="date">Fri 27 May 2011 15:26:51 BST</span>
<!-- Created <span class="date">Fri 27 May 2011 15:26:51 BST</span> -->
</div>

</div><!-- #pageinfo -->

<!-- from Dave Scott -->
</div><!-- .pagefooter #footer -->

</body>
</html>
